# Challenge-3_Customer-Insights-DataSteel

**Introduction**:

Just conquered a thrilling SQL challenge by SteelData, delving into the fascinating realm of Customer Insights! Utilizing the robust combo of PostgreSQL and PgAdmin4, I tackled a series of 10 insightful questions exploring the depths of customer data. Check out my solution in the GitHub repository.

**Questions**:

1. What are the names of all the countries in the country table?
2. What is the total number of customers in the customers table?
3. What is the average age of customers who can receive marketing emails (can_email is set to 'yes')?
4. How many orders were made by customers aged 30 or older?
5. What is the total revenue generated by each product category?
6. What is the average price of products in the 'food' category?
7. How many orders were made in each sales channel (sales_channel column) in the orders table?
8.What is the date of the latest order made by a customer who can receive marketing emails?
9. What is the name of the country with the highest number of orders?
10. What is the average age of customers who made orders in the 'vitamins' product category?


**Table**:

![image](https://github.com/4bhijeet341/Challenge-3_Customer-Insights-DataSteel-/assets/150332865/69554efb-6102-4372-b878-70c03925b36a)


![image](https://github.com/4bhijeet341/Challenge-3_Customer-Insights-DataSteel-/assets/150332865/53696a62-713f-43db-9b18-6180cca61f84)


![image](https://github.com/4bhijeet341/Challenge-3_Customer-Insights-DataSteel-/assets/150332865/d230075f-05c2-4c66-a1e6-e8921e59ba47)

**Solution:**

``` SQL
CREATE TABLE country (
country_id INT PRIMARY KEY,
country_name VARCHAR(50),
head_office VARCHAR(50)
);
--------------------
INSERT INTO country (country_id, country_name, head_office)
VALUES (1, 'UK', 'London'),
(2, 'USA', 'New York'),
(3, 'China', 'Beijing');
--------------------
CREATE TABLE customers (
customer_id INT PRIMARY KEY,
first_shop DATE,
age INT,
rewards VARCHAR(50),
can_email VARCHAR(50)
);
--------------------
INSERT INTO customers (customer_id, first_shop, age, rewards, can_email)
VALUES (1, '2022-03-20', 23, 'yes', 'no'),
(2, '2022-03-25', 26, 'no', 'no'),
(3, '2022-04-06', 32, 'no', 'no'),
(4, '2022-04-13', 25, 'yes', 'yes'),
(5, '2022-04-22', 49, 'yes', 'yes'),
(6, '2022-06-18', 28, 'yes', 'no'),
(7, '2022-06-30', 36, 'no', 'no'),
(8, '2022-07-04', 37, 'yes', 'yes');
--------------------
CREATE TABLE orders (
order_id INT PRIMARY KEY,
customer_id INT,
date_shop DATE,
sales_channel VARCHAR(50),
country_id INT,
FOREIGN KEY (customer_id) REFERENCES customers(customer_id),
FOREIGN KEY (country_id) REFERENCES country(country_id)
);
--------------------
INSERT INTO orders (order_id, customer_id, date_shop, sales_channel, country_id)
VALUES (1, 1, '2023-01-16', 'retail', 1),
(2, 4, '2023-01-20', 'retail', 1),
(3, 2, '2023-01-25', 'retail', 2),
(4, 3, '2023-01-25', 'online', 1),
(5, 1, '2023-01-28', 'retail', 3),
(6, 5, '2023-02-02', 'online', 1),
(7, 6, '2023-02-05', 'retail', 1),
(8, 3, '2023-02-11', 'online', 3);
--------------------
CREATE TABLE products (
product_id INT PRIMARY KEY,
category VARCHAR(50),
price NUMERIC(5,2)
);
--------------------
INSERT INTO products (product_id, category, price)
VALUES (1, 'food', 5.99),
(2, 'sports', 12.49),
(3, 'vitamins', 6.99),
(4, 'food', 0.89),
(5, 'vitamins', 15.99);
--------------------
CREATE TABLE baskets (
order_id INT,
product_id INT,
FOREIGN KEY (order_id) REFERENCES orders(order_id),
FOREIGN KEY (product_id) REFERENCES products(product_id)
);
--------------------
INSERT INTO baskets (order_id, product_id)
VALUES (1, 1),
(1, 2),
(1, 5),
(2, 4),
(3, 3),
(4, 2),
(4, 1),
(5, 3),
(5, 5),
(6, 4),
(6, 3),
(6, 1),
(7, 2),
(7, 1),
(8, 3),
(8, 3);
--------------------

--Questions & Solutions--

--1. What are the names of all the countries in the country table?
SELECT distinct country_name 
FROM country;
--
--2. What is the total number of customers in the customers table?
SELECT COUNT(customer_id) as total_customers
FROM customers;
--
--3. What is the average age of customers who can receive marketing emails (can_email is set to 'yes')?
SELECT ROUND(avg(age)) as average_age
FROM customers
WHERE can_email = 'yes';
--
--4. How many orders were made by customers aged 30 or older?
SELECT count(o.order_id) as order_count
FROM orders o
INNER JOIN customers c
ON o.customer_id = c.customer_id AND c.age >= 30;
--
--5. What is the total revenue generated by each product category?
SELECT p.category, SUM(p.price) as revenue_generated
FROM products p
INNER JOIN baskets b
ON p.product_id = b.product_id
INNER JOIN orders o
ON o.order_id = b.order_id
GROUP BY p.category
ORDER BY revenue_generated desc;
--
--6. What is the average price of products in the 'food' category?
SELECT avg(price) as avg_price
FROM products
WHERE category = 'food';
--
--7. How many orders were made in each sales channel (sales_channel column) in the orders table?
SELECT sales_channel, COUNT(order_id) orders_made
FROM orders
GROUP BY sales_channel
ORDER BY orders_made desc;
--
--8.What is the date of the latest order made by a customer who can receive marketing emails?
SELECT MAX(o.date_shop) as latest_date_of_order
FROM orders o
INNER JOIN customers c on
o.customer_id = c.customer_id AND c.can_email = 'yes';
--
--9. What is the name of the country with the highest number of orders?
SELECT c.country_name
FROM country c
INNER JOIN orders o
ON c.country_id = o.order_id
GROUP BY c.country_name
ORDER BY MAX(o.order_id) LIMIT 1;
--
--10. What is the average age of customers who made orders in the 'vitamins' product category?
SELECT avg(c.age) as avg_age
FROM baskets b
INNER JOIN products p ON b.product_id = p.product_id
INNER JOIN orders o ON p.product_id = b.product_id 
INNER JOIN customers c ON c.customer_id = o.customer_id and p.category ='vitamins';

```

**Conclusion**:

The challenge demanded an intermediate level of SQL proficiency, encouraging data enthusiasts to attempt the questions independently before seeking solutions. Embracing such challenges is a great way to enhance one's skills, and I highly recommend fellow enthusiasts to take on similar exercises. Special thanks to SteelData for providing this insightful challengeâ€”onto the next one now! ðŸš€ #SQLChallenge #CustomerInsights #DataEnthusiast #SteelDataChallenge

